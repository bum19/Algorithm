
# -- 코드를 입력하세요
SELECT CAR_ID, CAR.CAR_TYPE, TRUNCATE(DAILY_FEE * 30 * (100-DISCOUNT_RATE) / 100,0) FEE
FROM CAR_RENTAL_COMPANY_CAR CAR LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN DC ON CAR.CAR_TYPE = DC.CAR_TYPE
WHERE DC.DURATION_TYPE = '30일 이상'
AND (CAR.CAR_TYPE = '세단' OR CAR.CAR_TYPE = "SUV")
AND DAILY_FEE * 30 * (100-DISCOUNT_RATE) / 100 >= 500000
AND DAILY_FEE * 30 * (100-DISCOUNT_RATE) / 100 < 2000000
AND CAR_ID NOT IN (
SELECT CAR_ID
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE ('2022-11-01' BETWEEN START_DATE AND END_DATE) 
            OR ('2022-11-30' BETWEEN START_DATE AND END_DATE)
    OR
    (START_DATE BETWEEN '2022-11-01' AND '2022-11-30') OR (END_DATE BETWEEN '2022-11-01' AND '2022-11-30')
)
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC;

